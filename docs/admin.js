/* code omitted for brevity - same as before */